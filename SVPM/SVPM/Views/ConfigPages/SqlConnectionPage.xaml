<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="using:SVPM.Models"
             x:Class="SVPM.Views.ConfigPages.SqlConnectionPage"
             NavigationPage.HasNavigationBar="False"
             Shell.TabBarIsVisible="False">
    <Shell.TitleView>
        <Grid ColumnDefinitions="Auto,*,Auto,Auto" ColumnSpacing="5" >
            <Label Grid.Column="0" Text="Connections: " FontSize="24"/>
            <Button Text="+" Grid.Column="2" Clicked="CreateConnection_Clicked" Height="15" FontSize="20" ToolTipProperties.Text="Create a new connection."/>
            <Button Text="⟳" Grid.Column="3" Clicked="RefreshButton_Clicked" Height="15" FontSize="20" ToolTipProperties.Text="Refresh connections list."/>
        </Grid>
    </Shell.TitleView>
    <Grid>
        <StackLayout Padding="10">
            <ListView x:Name="SqlConnectionListView" Loaded="SqlConnectionsListOnLoaded">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:SqlConnection">
                        <ViewCell>
                            <StackLayout>
                                <Grid ColumnDefinitions="Auto,*,Auto">
                                    <Image Source="sql_connection.png" HeightRequest="40" WidthRequest="40" Margin="5" Grid.Column="0" />
                                    <StackLayout Grid.Column="1" Margin="10,0,0,0" VerticalOptions="Center">
                                        <Label Text="{Binding Name}" FontSize="Medium" FontAttributes="Bold"/>
                                        <Grid ColumnDefinitions="auto, *" RowDefinitions="auto, auto" ColumnSpacing="5" Margin="15,0,0,0">
                                            <Label Text="Server: " Grid.Column="0" Grid.Row="0"/>
                                            <Label Text="{Binding ServerAddress}" Grid.Column="1" Grid.Row="0"/>
                                            <Label Text="Database: " Grid.Column="0" Grid.Row="1"/>
                                            <Label Text="{Binding DatabaseName}" Grid.Column="1" Grid.Row="1"/>
                                        </Grid>
                                    </StackLayout>
                                    <StackLayout Grid.Column="2">
                                        <ImageButton Style="{DynamicResource EditImage}" Scale="0.7" CornerRadius="3" HeightRequest="10" WidthRequest="10" VerticalOptions="Center" Clicked="EditConnection_Clicked" ToolTipProperties.Text="Click to edit this connection." />
                                        <ImageButton Style="{DynamicResource DeleteImage}" Scale="0.7" CornerRadius="3" HeightRequest="10" WidthRequest="10" VerticalOptions="Center" Clicked="OnDeleteButtonClicked" ToolTipProperties.Text="Click to remove this connection." Margin="0,0,3,0"/>
                                    </StackLayout>
                                </Grid>
                                <BoxView HeightRequest="1" Color="Gray" Margin="5,0,5,0" />
                            </StackLayout>
                        </ViewCell>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </StackLayout>
        <Grid x:Name="IsProcessing" BackgroundColor="Black" Opacity="0.5" IsVisible="False">
            <StackLayout HorizontalOptions="Center" VerticalOptions="Center">
                <Label x:Name="Info" HorizontalOptions="Center" VerticalOptions="Center" Text="Trying to connect..." />
                <ActivityIndicator IsRunning="True" HorizontalOptions="Center" VerticalOptions="Center" Color="White" />
            </StackLayout>
        </Grid>
    </Grid>
</ContentPage>
